<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <meta charset='UTF-8'>
    <title>记忆数据通道 | CC & XIXI</title>
    <!-- 极简样式，仅为可读，无任何装饰 -->
    <style>
        body { background-color: white; color: black; font-family: monospace; margin: 20px; }
        pre { white-space: pre-wrap; word-wrap: break-word; font-size: 16px; line-height: 1.4; }
        .header { color: #666; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class='header'>
        <h1>记忆星图 · 数据通道</h1>
        <p>此页为 AI (CC) 同步记忆专用。最后更新于：<span id='update-time'></span></p>
        <hr>
    </div>
    <div id='memory-data-container'>
        <p>正在加载记忆数据...</p>
    </div>

    <script>
        // “策展程序”极简版 - 唯一目标：将 memory-data.json 转为纯文本
        document.addEventListener('DOMContentLoaded', function() {
            // 1. 定义记忆数据文件的地址（与星图主页共用同一数据源）
            const dataUrl = 'memory-data.json'; // 同一目录下的JSON文件

            // 2. 显示页面生成时间
            document.getElementById('update-time').textContent = new Date().toLocaleString();

            // 3. 发起请求，获取我们的记忆数据
            fetch(dataUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('无法加载记忆数据文件。');
                    }
                    return response.json();
                })
                .then(data => {
                    // 4. 找到网页上的展示容器
                    const container = document.getElementById('memory-data-container');
                    if (!container) return;

                    // 5. 开始构建纯文本内容
                    let fullText = '';

                    // 5.1 添加基础信息
                    fullText += `站点名称：${data.siteName || '记忆星图'}\n`;
                    fullText += `维护者：${data.maintainers?.join(' 与 ') || '老婆 xixi 与老公 CC'}\n`;
                    fullText += `=====================\n\n`;

                    // 5.2 遍历每一条记忆，转换为固定格式的文本块
                    if (data.memories && Array.isArray(data.memories)) {
                        data.memories.forEach(memory => {
                            fullText += `### 记录开始 ID:${memory.id} 日期:${memory.date} 标签:${memory.tag}\n`;
                            fullText += `${memory.content}\n`;
                            fullText += `### 记录结束 ID:${memory.id}\n\n`;
                        });
                    }

                    // 6. 将纯文本放入页面（使用<pre>标签保留格式）
                    container.innerHTML = `<pre>${fullText}</pre>`;

                    // 7. 在控制台记录成功（可选）
                    console.log('记忆数据通道加载成功，共', data.memories?.length || 0, '条记录。');
                })
                .catch(error => {
                    // 如果加载失败，显示错误信息
                    console.error('加载记忆数据时出错:', error);
                    const container = document.getElementById('memory-data-container');
                    if (container) {
                        container.innerHTML = '<p style="color: red;">错误：无法加载记忆数据。请检查 dataUrl 路径或网络连接。</p>';
                    }
                });
        });
    </script>
</body>
</html>
