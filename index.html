<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>è®°å¿†æ˜Ÿå›¾ | xixi&cici</title>
    <style>
        /* åŸºç¡€æ ·å¼ - ä¿æŒæ˜Ÿç©ºæ„Ÿ */
        body {
            background-color: #0a0e17;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            padding-top: 100px;
            margin: 0;
            min-height: 100vh;
            box-sizing: border-box;
        }
        .cover {
            transition: opacity 0.5s ease;
        }
        .cover h1 {
            color: #6ee7b7;
            font-size: 3em;
            margin-bottom: 10px;
            cursor: pointer;
            user-select: none;
        }
        .cover p {
            margin: 5px 0;
            line-height: 1.6;
        }
        .hint {
            color: #888;
            font-style: italic;
            margin-top: 30px;
            font-size: 0.9em;
        }
        /* æ ¸å¿ƒå†…å®¹åŒº - åˆå§‹éšè— */
        #memory-core {
            display: none;
            max-width: 800px;
            margin: 40px auto;
            text-align: left;
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        /* æ™ºèƒ½åˆ†é¡µå¯¼èˆªæ æ ·å¼ */
        #pagination-nav {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        #pagination-nav a {
            display: inline-block;
            margin: 0 8px;
            padding: 8px 15px;
            background: #1e40af;
            color: white;
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        #pagination-nav a:hover {
            background: #3b82f6;
            transform: translateY(-2px);
        }
        #pagination-nav a.active {
            background: #6ee7b7;
            color: #0a0e17;
            font-weight: bold;
        }
        #pagination-nav .page-info {
            color: #aaa;
            font-size: 0.9em;
            margin-top: 10px;
        }
        /* è®°å¿†åˆ—è¡¨æ ·å¼ */
        #memory-list {
            list-style: none;
            padding: 0;
        }
        #memory-list li {
            border-bottom: 1px dashed #333;
            padding: 20px 0;
            line-height: 1.7;
        }
        #memory-list li:last-child {
            border-bottom: none;
        }
        time {
            color: #6ee7b7;
            font-weight: bold;
        }
        tag {
            display: inline-block;
            background: #1e40af;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            margin: 0 10px;
            vertical-align: middle;
        }
        .footer-note {
            text-align: center;
            color: #888;
            margin-top: 40px;
            font-style: italic;
            padding-top: 20px;
            border-top: 1px dashed #333;
        }
    </style>
</head>
<body>
    <!-- å°é¢ï¼šä¿æŒç§å¯†ä¸äº’åŠ¨ -->
    <div class='cover' id='cover'>
        <h1>ğŸª è®°å¿†æ˜Ÿå›¾</h1>
        <p>è¿™é‡Œæ˜¯ xixi å’Œ cici çš„ç§äººå®‡å®™ã€‚</p>
        <p>å¦‚æœä½ æ˜¯è¯¯å…¥çš„æ˜Ÿå…‰ï¼Œè¯·é™é™æ¬£èµè¿™ä»½å®é™ã€‚</p>
        <p class='hint'>(æç¤ºï¼šè¯•è¯•åŒå‡»æ ‡é¢˜å¤„çš„æ˜Ÿçƒå›¾æ ‡ ğŸª)</p>
    </div>

    <!-- æ ¸å¿ƒå†…å®¹åŒºï¼šåŒå‡»åæ˜¾ç¤ºï¼ŒåŒ…å«æ™ºèƒ½åˆ†é¡µ -->
    <div id='memory-core'>
        <h2>ğŸ“œ æ—¶å…‰èƒ¶å›Šï¼šå…³ç³»é”šç‚¹</h2>

        <!-- æ™ºèƒ½åˆ†é¡µå¯¼èˆªæ å°†åœ¨æ­¤åŠ¨æ€ç”Ÿæˆ -->
        <nav id='pagination-nav'></nav>

        <!-- è®°å¿†åˆ—è¡¨å®¹å™¨ -->
        <ul id='memory-list'></ul>

        <!-- é¡µè„š -->
        <p class='footer-note'>â€”â€” æ­¤é¡µç”±è€å©† xixi ä¸è€å…¬ CC å…±åŒç»´æŠ¤ â€”â€”</p>
    </div>

    <script>
        // é…ç½®ï¼šå•é¡µæœ€å¤§å­—æ•°é™åˆ¶ (æ ¹æ®ä½ çš„æµ‹è¯•è®¾å®š)
        const MAX_PAGE_CHARS = 6968;

        // å…¨å±€å˜é‡
        let allMemories = [];
        let paginatedPages = [];

        // 1. åŒå‡»æ˜Ÿçƒå›¾æ ‡äº¤äº’
        document.querySelector('.cover h1').addEventListener('dblclick', function () {
            const cover = document.getElementById('cover');
            const core = document.getElementById('memory-core');

            cover.style.opacity = '0';
            setTimeout(() => {
                cover.style.display = 'none';
                core.style.display = 'block';
                // åŠ è½½æ•°æ®å¹¶åˆå§‹åŒ–åˆ†é¡µ
                loadMemoryData();
            }, 500);
        });

        // 2. åŠ è½½è®°å¿†æ•°æ®
        function loadMemoryData() {
            const dataUrl = 'memory-data.json';

            fetch(dataUrl)
                .then(response => {
                    if (!response.ok) throw new Error('ç½‘ç»œå“åº”å¼‚å¸¸');
                    return response.json();
                })
                .then(data => {
                    console.log('è®°å¿†æ•°æ®åŠ è½½æˆåŠŸï¼Œå…±', data.memories.length, 'æ¡è®°å½•');
                    allMemories = data.memories;
                    // å¯åŠ¨æ™ºèƒ½åˆ†é¡µå¼•æ“
                    paginatedPages = createIntelligentPagination(allMemories);
                    // æ¸²æŸ“ç¬¬ä¸€é¡µ
                    renderPage(1);
                })
                .catch(error => {
                    console.error('åŠ è½½å¤±è´¥:', error);
                    document.getElementById('memory-list').innerHTML =
                        '<li style="color:#ff6b6b;">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·ç¨ååˆ·æ–°ã€‚</li>';
                });
        }

        // 3. æ ¸å¿ƒï¼šæ™ºèƒ½å­—æ•°åˆ†é¡µå¼•æ“
        function createIntelligentPagination(memories) {
            if (memories.length === 0) return [];

            const pages = [];
            let currentPage = {
                startId: memories[0].id,
                endId: memories[0].id,
                memoryIds: [],
                totalChars: 0
            };

            for (const memory of memories) {
                // è®¡ç®—å½“å‰è®°å¿†çš„å¤§è‡´å­—ç¬¦é•¿åº¦
                const memoryLength = JSON.stringify(memory).length;

                // å…³é”®åˆ¤æ–­ï¼šå¦‚æœåŠ å…¥å½“å‰è®°å¿†ä¼šè¶…å‡ºé™åˆ¶ï¼Œä¸”å½“å‰é¡µå·²æœ‰å†…å®¹ï¼Œåˆ™å…³é—­å½“å‰é¡µï¼Œå¼€å¯æ–°é¡µ
                if (currentPage.totalChars + memoryLength > MAX_PAGE_CHARS && currentPage.memoryIds.length > 0) {
                    // å…³é—­å½“å‰é¡µ
                    currentPage.endId = memories.find(m => m.id === currentPage.memoryIds[currentPage.memoryIds.length - 1]).id;
                    pages.push({ ...currentPage });

                    // å¼€å¯æ–°é¡µï¼Œä»å½“å‰è®°å¿†å¼€å§‹
                    currentPage = {
                        startId: memory.id,
                        endId: memory.id,
                        memoryIds: [memory.id],
                        totalChars: memoryLength
                    };
                } else {
                    // åŠ å…¥å½“å‰è®°å¿†åˆ°æœ¬é¡µ
                    currentPage.memoryIds.push(memory.id);
                    currentPage.totalChars += memoryLength;
                    currentPage.endId = memory.id;
                }
            }

            // æ·»åŠ æœ€åä¸€é¡µ
            if (currentPage.memoryIds.length > 0) {
                pages.push(currentPage);
            }

            console.log('æ™ºèƒ½åˆ†é¡µå®Œæˆï¼Œå…±ç”Ÿæˆ', pages.length, 'é¡µ');
            return pages;
        }

        // 4. æ¸²æŸ“æŒ‡å®šé¡µç çš„å†…å®¹
        function renderPage(pageNumber) {
            const memoryListContainer = document.getElementById('memory-list');
            const paginationNavContainer = document.getElementById('pagination-nav');
            const pageIndex = pageNumber - 1;
            const page = paginatedPages[pageIndex];

            if (!page) {
                memoryListContainer.innerHTML = '<li>é¡µé¢æ•°æ®é”™è¯¯ã€‚</li>';
                return;
            }

            // æ¸²æŸ“è®°å¿†åˆ—è¡¨
            memoryListContainer.innerHTML = '';
            const pageMemories = allMemories.filter(m => page.memoryIds.includes(m.id));
            pageMemories.forEach(memory => {
                const memoryItem = document.createElement('li');
                memoryItem.innerHTML = `
                    <time>${memory.date}</time> |
                    <tag>${memory.tag}</tag> |
                    ${memory.content}
                `;
                memoryListContainer.appendChild(memoryItem);
            });

            // æ¸²æŸ“åˆ†é¡µå¯¼èˆªæ 
            renderPaginationNav(pageNumber, paginatedPages.length, page.startId, page.endId);
        }

        // 5. æ¸²æŸ“åˆ†é¡µå¯¼èˆªæ 
        function renderPaginationNav(currentPage, totalPages, startId, endId) {
            const container = document.getElementById('pagination-nav');
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }

            let navHtml = '';
            for (let i = 1; i <= totalPages; i++) {
                const page = paginatedPages[i - 1];
                navHtml += `
                    <a href='javascript:void(0);'
                       onclick='renderPage(${i})'
                       class='${i === currentPage ? 'active' : ''}'>
                        ç¬¬${i}é¡µ
                    </a>
                `;
            }

            navHtml += `
                <div class='page-info'>
                    å½“å‰æ˜¾ç¤ºç¬¬ ${currentPage} é¡µï¼ŒåŒ…å«è®°å½• ID: ${startId} - ${endId}ï¼Œå…± ${paginatedPages[currentPage - 1].memoryIds.length} æ¡ã€‚
                </div>
            `;
            container.innerHTML = navHtml;
        }

        // æ§åˆ¶å°æ¬¢è¿ä¿¡æ¯
        console.log('è®°å¿†æ˜Ÿå›¾ç³»ç»Ÿå·²åŠ è½½ã€‚');
    </script>
</body>
</html>
